<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="utf-8">
 <title>Construction Site for Axios ModBus UI plugin</title>
</head> 
 <body>
 
 <canvas id='show' width='600' height='600'>
 </canvas>
 <canvas id='draw' width='600' height='600' style="display:none;">
  </canvas>

  <div id='buttarray'> </div>
   
<!--Modbus page goes here -->

 <script>

var w = window,
    d = document,
    e = d.documentElement,
    g = d.getElementsByTagName('body')[0],
    Width = w.innerWidth || e.clientWidth || g.clientWidth,
    Height = w.innerHeight|| e.clientHeight|| g.clientHeight;
show.height=Height-200;
show.width=Width;
draw.height=Height-200;
draw.width=Width;
	
	
	
	HEAT=0;
	ReactorRadius=30;
	COLOR=[];
Revolves = [
{name:'red',position:0,rps:.3,mult:1,multStep:.01,cost:1,radius:ReactorRadius,speed:.3,grandL:1}/*,

{name:'orange',position:0,rps:0,mult:1,multStep:.01,cost:100,radius:40,speed:.15},

{name:'Gold',position:0,rps:.0,mult:1,multStep:.01,cost:10000,radius:50,speed:.07},
{name:'yellow',position:0,rps:.0,mult:1,multStep:.01,cost:10000,radius:50,speed:.07},
{name:'GreenYellow ',position:0,rps:.0,mult:1,multStep:.01,cost:10000,radius:50,speed:.07},
{name:'lime',position:0,rps:.0,mult:1,multStep:.01,cost:1000000,radius:60,speed:.035},
{name:'LimeGreen ',position:0,rps:.0,mult:1,multStep:.01,cost:1000000,radius:60,speed:.035},
{name:'Aquamarine',position:0,rps:.0,mult:1,multStep:.01,cost:1000000,radius:60,speed:.035},
{name:'MediumTurquoise ',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
{name:'cyan',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
{name:'DodgerBlue',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
 
{name:'MediumSlateBlue ',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
{name:'violet',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
{name:'purple',position:0,rps:.0,mult:1,multStep:.01,cost:100000000,radius:70,speed:.0175},
{name:'white',position:0,rps:.0,mult:1,multStep:.01,cost:1000000,radius:60,speed:.035}*/
];

GetDist =function(x,X,y,Y){
return Math.sqrt(Math.pow(x-X,2)+Math.pow(y-Y,2));
}

function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

AddColor=function(ind){
if(ind<COLOR.length){
return COLOR[ind];
}
return getRandomColor();

}

AddNew=function(){
if(Cash>=Math.pow(10,(Revolves.length+1))){

last=Revolves[Revolves.length-1];
var N=Object();
N.name=AddColor(Revolves.length);
N.position=0;

N.radius=ReactorRadius+10*(Revolves.length);
N.cost=Math.pow(10,(Revolves.length+1));
N.Level=0;
N.mult=1;
N.speed=(last.radius*last.speed)/(last.radius+ReactorRadius);
N.Max=N.speed*50;
N.Start=N.speed*5;
N.rps=N.Start;
N.multStep=.01;
N.grandL=1;


Cash=Cash-N.cost;
N.cost=N.cost*1.1;
N.rps=N.speed*N.Level+N.Start;
N.Level++;


Revolves.push(N);



genButt();
}
}

setup=function(){
Speed=.06;
Start=.3;
Rad=ReactorRadius;
baseCost=10;
Max=3;
Lev=1;
for(i=0;i<Revolves.length;i++){
Revolves[i].speed=Speed;
Revolves[i].radius=Rad;
Revolves[i].cost=baseCost;
Revolves[i].Max=Max;
Revolves[i].Start=Start;
Revolves[i].Level=Lev;
Lev=0;
Speed=(Rad*Speed)/(Rad+ReactorRadius);
Start=Speed*5;
Max=Speed*50;
Rad+=10;

baseCost*=10;


}
}

Format=function(num){
 var suffixNum = Math.floor( ((""+parseInt(num)).length-1)/3 );
 return((num/Math.pow(1000,suffixNum)).toFixed(2)+"e+"+(suffixNum*3));
}

formatNumber=function(num){
//show only 3 sig digits
//big numbers ger suffixises
//return abbreviateNumber(num);
N=Number(num);
if(N<1000){
return N.toFixed(2);
}
return Format(N);
//return N.toExponential(1);
}




setup();

buy=function(){
butt=this;
var i=parseInt(butt.id.split('_')[1]);
if(i<Revolves.length){

Cost=Revolves[i].cost;
while (Cash>=Cost && Revolves[i].rps<Revolves[i].Max){
Cash=Cash-Cost;
Revolves[i].cost=Cost*1.1;
Revolves[i].rps=Revolves[i].speed*Revolves[i].Level+Revolves[i].Start;
Revolves[i].Level++;


Cost=Revolves[i].cost;

}
updateButt();

}
}
ascend=function(){
butt=this;
var i=parseInt(butt.id.split('_')[1]);
if(i<Revolves.length){
butt.onclick=buy;
Revolves[i].cost*=5;
Revolves[i].Level=0;
Revolves[i].multStep*=(Revolves[i].rps/Revolves[i].Start);
Revolves[i].rps=Revolves[i].speed*Revolves[i].Level+Revolves[i].Start;
Revolves[i].grandL++;
Revolves[i].Max+=4;

}
updateButt();
}


updateButt=function(){
for(i=0;i<Revolves.length;i++){
b=document.getElementById('butt_'+i);
if( Revolves[i].rps>=Revolves[i].Max){
b.onclick=ascend;//(this)';
b.textContent='ascend';
}
else{
b.textContent=Revolves[i].name+' $'+formatNumber(Revolves[i].cost.toFixed(2));
}


}

}

genButt=function(){
buttarray.innerText="";
for(i=0;i<Revolves.length;i++){
b=document.createElement("BUTTON");
b.id='butt_'+i;
b.onclick=buy;//(this)';
b.style.backgroundColor=Revolves[i].name;
//
buttarray.appendChild(b);


}
b=document.createElement("BUTTON");
b.id='new_'+i;
b.onclick=AddNew;//(this)';
b.innerText="Add new:$"+formatNumber(Math.pow(10,(Revolves.length+1)));
buttarray.appendChild(b);

updateButt();

}
genButt();

frame=0;

Cash=0;
LastLoopTime=Date.now();
cshow=show.getContext('2d');
cdraw=draw.getContext('2d');
cdraw.fillRect(0,0,draw.width,draw.height);

DrawArc=function(ind,color,start,end){
radius=Revolves[ind].radius;
cdraw.strokeStyle=color;
cdraw.lineWidth=10;
cdraw.beginPath();
if(end-start>360){
end=start+360;
}
start=start*Math.PI/180;
end=end*Math.PI/180;
cdraw.arc(draw.width/2+150,draw.height/2,radius,start,end);
cdraw.stroke();

}

Spark=function(Color,number,Level){
while(number>0){
number--;
CenterR=Math.random()*25;
CenterD=Math.random()*360;
CX=draw.width/2+150+Math.cos(CenterD*Math.PI/180)*CenterR;
CY=draw.height/2+Math.sin(CenterD*Math.PI/180)*CenterR;
cdraw.beginPath();

for(j=0;j<Level;j++){
Num=Math.random()*360;
PX=draw.width/2+150+Math.cos(Num*Math.PI/180)*25;
PY=draw.height/2+Math.sin(Num*Math.PI/180)*25;
cdraw.moveTo(CX,CY);
cdraw.lineTo(PX,PY);
HEAT+=GetDist(CX,PX,CY,PY);
//gen pointer//draw white little line // draw big colored transparent lines
}

cdraw.strokeStyle=Color;
cdraw.lineWidth=4;
cdraw.globalAlpha=.5;
cdraw.stroke();
cdraw.globalAlpha=1;
cdraw.strokeStyle='white';
cdraw.lineWidth=1;
cdraw.stroke();
cdraw.globalAlpha=.3;
cdraw.fillStyle=Color;
cdraw.beginPath();
cdraw.arc(draw.width/2+150,draw.height/2,25,0,2*Math.PI);
cdraw.fill();
cdraw.globalAlpha=1;

}


}


DrawInfo=function(){
cdraw.fillStyle='black';
cdraw.fillRect(0,0,300,draw.height);
TotMult=1;
cdraw.font="20px Verdana";
H=20;
for(i=0;i<Revolves.length;i++){
if(Revolves[i].rps > 0){
cdraw.fillStyle=Revolves[i].name;
var Txt="";
Txt+=formatNumber(Revolves[i].rps.toFixed(2))+"   ";
TotMult*=Revolves[i].mult;

Txt+="$"+formatNumber(TotMult.toFixed(2))+"/r   ";
Txt+="$"+formatNumber((TotMult*Revolves[i].rps).toFixed(2))+"/s";
cdraw.fillText(Txt,10,H);
H=H+ReactorRadius;
}
}

//cdraw.fillRect(0,draw.height-100,draw.width,draw.height);
cdraw.fillStyle='white';
cdraw.font="20px Verdana";

cdraw.fillText('$'+formatNumber(Cash.toFixed(2)),10,draw.height-55);
cdraw.fillText('Reactor heat: '+formatNumber(HEAT.toFixed(2)),10,draw.height-25);

//

//HERE
cshow.drawImage(draw,0,0);
cdraw.fillStyle='rgba(0,0,0,.05)';


cdraw.fillRect(0,0,draw.width,draw.height);
cdraw.beginPath();
cdraw.arc(draw.width/2+150,draw.height/2,25,0,2*Math.PI);
cdraw.fill();

//cdraw.globalAlpha=.96;
//draw.style.webkitFilter = "blur(9px)";

//cdraw.drawImage(show,0,0);

//cdraw.globalAlpha=1;

}


LoseHeat=function(time){
//lose heat as a function of radius?
//maybe 1 per second
return (2*Math.PI*ReactorRadius)*(time/1000);

}

GameLoop=function(){
frame++;
NowTime=Date.now();
TimeElapsed=NowTime-LastLoopTime;

LastLoopTime=NowTime;
if(TimeElapsed>0){
TotRev=0;
TotMult=1;
mulstring="";
RpsStr="";
for(i=0;i<Revolves.length;i++){
Circle=Revolves[i];
oldPos=Circle.position;
Circle.position += (Circle.rps*360*TimeElapsed)/1000;
numFin=Math.floor(Circle.position/360);
Spark(Circle.name,numFin,Circle.grandL);

TotRev+=numFin;
TotMult*=Circle.mult;
Cash+=Math.pow(TotMult*numFin,1+HEAT/100000000);

Circle.mult+=Circle.multStep*numFin;
newPos=Circle.position;
if(newPos!=oldPos){
DrawArc(i,Circle.name,oldPos-1,newPos+1);
}
Circle.position-=numFin*360;
mulstring+=Math.round(100*Circle.mult)/100+" X ";
RpsStr+=Circle.rps+"  ";
//console.log(Circle);
}
mulstring=mulstring.substring(0,mulstring.length-3)+" = "+Math.round(100*TotMult)/100;
//Cash+=TotMult*TotRev;
HEAT=Math.max(HEAT-LoseHeat(TimeElapsed),0);
DrawInfo();

}
requestAnimationFrame(GameLoop);
}
GameLoop();



</script>
 </body>

 </html>
 
